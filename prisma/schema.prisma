generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  phone     String?
  firstName String
  lastName  String
  password  String
  avatar    String?
  role      String?
  sessions  Session[]
  order     Order[]
  isActive  Boolean   @default(false)
  isVerify  Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("users")
}

model Brand {
  id            String          @id @default(cuid())
  brandName     String          @unique
  logo          String
  description   String
  website       String
  contact       String
  tagline       String
  color         String
  categorieName String
  isPrimary     Boolean         @default(false)
  isActive      Boolean         @default(false)
  isFeature     Boolean         @default(false)
  notes         String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  brandcontacts BrandContacts[]
  brandTerms    BrandTerms[]
  brandBankings BrandBanking[]
  vouchers      Vouchers[]
  order         Order[]
  settlements   Settlements[]
  integrations  Integration[]
}

model BrandContacts {
  id        String   @id @default(cuid())
  name      String
  role      String
  email     String
  phone     String
  notes     String?
  isPrimary Boolean  @default(false)
  brandId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  brands    Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model BrandTerms {
  id                 String           @id @default(cuid())
  settelementTrigger SettelmentStatus @default(onRedemption)
  commissionType     String?
  commissionValue    Int              @default(0)
  maxDiscount        Int?             @default(0)
  minOrderValue      Int?             @default(0)
  currency           String?
  brackingPolicy      String?
  brackingShare      Int?             @default(0)
  contractStart      DateTime?
  contractEnd       DateTime?
  goLiveDate         DateTime?
  renewContract      Boolean          @default(false)
  vatRate            Int?             @default(0)
  internalNotes      String
  brandId            String
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  brands             Brand            @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model Vouchers {
  id                      String             @id @default(cuid())
  denominationype         String?
  denominations           Json?
  denominationCurrency    String?
  denominationValue Int?
  maxAmount               Int?               @default(0)
  minAmount               Int?               @default(0)
  expiryPolicy            String
  expiresAt               String?
  expiryValue             String?
  graceDays               Int?               @default(0)
  redemptionChannels      Json?
  partialRedemption       Boolean            @default(false)
  Stackable               Boolean            @default(false)
  maxUserPerDay           Int?
  termsConditionsURL      String?
  brandId                 String
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  brands                  Brand              @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model BrandBanking {
  id                  String                    @id @default(cuid())
  settlementFrequency SettlementFrequencyStatus @default(monthly)
  dayOfMonth          Int?                      @default(0)
  payoutMethod        PayoutMethodStatus        @default(EFT)
  invoiceRequired     Boolean                   @default(false)
  remittanceEmail     String?
  accountHolder       String
  accountNumber       String
  branchCode          String
  bankName            String
  SWIFTCode           String
  country             String
  accountVerification Boolean                   @default(false)
  brandId             String
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  brands              Brand                     @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model Integration {
  id       String  @id @default(cuid())
  platform String // e.g. Shopify, WooCommerce, Magento, Custom API
  storeUrl String? // Shopify/WooCommerce/Magento store URL

  // üîê Sensitive fields - must be hashed/encrypted before save
  apiKey         String? @db.Text
  apiSecret      String? @db.Text
  accessToken    String? @db.Text
  consumerKey    String? @db.Text
  consumerSecret String? @db.Text

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  brandId   String
  brand     Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model Occasion {
  id               String             @id @default(cuid())
  name             String             @unique
  emoji            String
  description      String
  image            String?
  type             String
  isActive         Boolean            @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  occasionCategory OccasionCategory[]
  order            Order[]
}

model OccasionCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  emoji       String
  image       String
  category    String
  isActive    Boolean  @default(false)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  occasionId  String
  occasions   Occasion @relation(fields: [occasionId], references: [id], onDelete: Cascade)
  orders      Order[]
}

model Categories {
  id   String @id @default(cuid())
  name String
}

model ReceiverDetail {
  id    String  @id @default(cuid())
  name  String
  phone String
  email String
  order Order[]
}

model Order {
  id                 String   @id @default(cuid())
  brandId            String
  occasionId         String
  subCategoryId      String?           // predefined category
  customCardId       String?           // custom card
  amount             Int
  currency           String?
  message            String
  isActive           Boolean           @default(false)
  sendType           SendStatus        @default(sendImmediately)
  deliveryMethod     deliveryMethodStatus @default(whatsapp)
  senderDetails      String
  giftCode           String
  orderNumber        String
  paymentMethod      String
  paymentStatus      String?
  totalAmount        Int?              @default(0)
  redemptionStatus   RedemptionStatus  @default(Issued)
  timestamp          DateTime          @default(now())
  userId             String
  receiverDetailId   String
  occasions          Occasion          @relation(fields: [occasionId], references: [id], onDelete: Cascade)
  brands             Brand             @relation(fields: [brandId], references: [id], onDelete: Cascade)
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  receiverDetail     ReceiverDetail    @relation(fields: [receiverDetailId], references: [id])
  occasionCategory   OccasionCategory? @relation(fields: [subCategoryId], references: [id])
  customCard         CustomCard?       @relation(fields: [customCardId], references: [id])
}


model Settlements {
  id              String   @id @default(cuid())
  brandId         String
  totalSold       Int
  Redeemed        String
  Outstanding     Int?
  settlementTerms String
  Amount          Int?
  lastPayment     DateTime
  status          Status   @default(Pending)
  brands          Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

enum Status {
  Pending
  Paid
  InReview
}

enum deliveryMethodStatus {
  whatsapp
  email
  print
}

enum RedemptionStatus {
  Issued
  Redeemed
  Exparied
  NotRedeemed
}

enum paymentStatus {
  COD
  Stripe
}

enum SendStatus {
  sendImmediately
  scheduleLater
}

enum SettelmentStatus {
  onRedemption
  onPurchase
}

enum CommissionStatus {
  Fixed
  Percentage
}

enum PolicyStatus {
  Retain
  Share
}

enum DenominationStatus {
  staticDenominations
  amountRange
}


enum IntegrationType {
  shopify
  woocommerce
  magento
  custom_api
  other
}

enum IntegrationStatus {
  active
  inactive
  pending
  error
}

enum SyncStatus {
  success
  failed
  partial
  in_progress
}

enum PayoutMethodStatus {
  EFT
  wire_transfer
  paypal
  stripe
  manual
}

enum SettlementFrequencyStatus {
  daily
  weekly
  monthly
  quarterly
}

model CustomCard {
  id          String   @id @default(cuid())
  title       String
  description String
  bgColor     String?
  bgImage     String?  @db.Text
  emoji       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders      Order[]
}